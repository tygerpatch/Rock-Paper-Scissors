  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 09:34:06) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 65ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 09:34:06) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 09:34:06) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 102ms (View: 36, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 09:34:06) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 101ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 09:34:06) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 69ms (View: 53, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 09:34:07) [GET]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 37ms (View: 20, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 16:53:17) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 348ms (DB: 40) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 16:53:18) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 16:53:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 87ms (View: 30, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 16:53:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 100ms (DB: 5) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 16:53:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 81ms (View: 63, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 16:53:19) [GET]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 43ms (View: 6, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 16:54:53) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 65ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 16:54:54) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 16:54:54) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 116ms (View: 37, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 16:54:54) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 113ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 16:54:54) [GET]
  [4;35;1mPlayer Load (4.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 90ms (View: 69, DB: 6) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 16:54:54) [GET]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 41ms (View: 6, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:08:07) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 407ms (DB: 26) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:08:08) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 19ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:08:08) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (4.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 108ms (View: 31, DB: 8) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:08:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 98ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 17:08:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 81ms (View: 62, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 17:08:08) [GET]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 49ms (View: 28, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:22:47) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 66ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:22:48) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:22:48) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 95ms (View: 32, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:22:48) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 104ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 17:22:48) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 86ms (View: 68, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 17:22:48) [GET]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 44ms (View: 26, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:30:07) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 357ms (DB: 25) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:30:08) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:30:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 96ms (View: 29, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:30:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 106ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 17:30:09) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 91ms (View: 72, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 17:30:09) [GET]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 44ms (View: 26, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:55:57) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 76ms (DB: 19) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 17:55:57) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:55:57) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 113ms (View: 41, DB: 6) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 17:55:57) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 108ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 17:55:57) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 83ms (View: 64, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 17:55:58) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 42ms (View: 25, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:10:15) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 68ms (DB: 17) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:10:15) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:10:15) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 93ms (View: 32, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:10:15) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 408ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:10:16) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 75ms (View: 58, DB: 2) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:10:16) [GET]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 41ms (View: 22, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:14:25) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 382ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:14:26) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:14:26) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 96ms (View: 40, DB: 2) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:14:26) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 151ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:14:26) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 82ms (View: 59, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:14:26) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 51ms (View: 28, DB: 5) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:15:57) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 53ms (DB: 18) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:15:58) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 17ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:15:58) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 95ms (View: 32, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:15:58) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 111ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:15:58) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 77ms (View: 58, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:15:59) [PUT]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 44ms (View: 25, DB: 2) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:17:18) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 417ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:17:19) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 16ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:17:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 96ms (View: 30, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:17:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 95ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:17:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 75ms (View: 57, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:17:19) [PUT]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 37ms (View: 22, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:42:59) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 359ms (DB: 20) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:43:00) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:43:00) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 92ms (View: 30, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:43:00) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 103ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:43:00) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 82ms (View: 56, DB: 7) | 200 OK [http://www.example.com/site/play]


Processing ApplicationController#index (for 127.0.0.1 at 2011-10-08 18:43:00) [POST]

ActionController::RoutingError (No route matches "/actionget_opponent" with {:method=>:post}):
  test/integration/playing_game_test.rb:35:in `test_simple_game'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendering rescues/layout (not_found)


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:43:00) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 112ms (View: 104, DB: 6) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:43:00) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 97ms (View: 87, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:43:00) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (0.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-08 22:43:01' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 118ms (View: 87, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:43:01) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-08 22:43:01' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 114ms (View: 69, DB: 13) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:43:01) [GET]
Redirected to http://www.example.com/
Completed in 7ms (DB: 3) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:43:01) [GET]
Redirected to http://www.example.com/
Completed in 4ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:44:00) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 64ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:44:00) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:44:00) [GET]
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 130ms (View: 38, DB: 8) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:44:00) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (2.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 102ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:44:00) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 89ms (View: 71, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing ApplicationController#index (for 127.0.0.1 at 2011-10-08 18:44:00) [POST]

ActionController::RoutingError (No route matches "/get_opponent" with {:method=>:post}):
  test/integration/playing_game_test.rb:35:in `test_simple_game'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendering rescues/layout (not_found)


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:44:01) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 101ms (View: 92, DB: 7) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:44:01) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 71ms (View: 64, DB: 6) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:44:01) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-08 22:44:01' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 95ms (View: 65, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:44:01) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (0.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-08 22:44:01' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 89ms (View: 55, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:44:01) [GET]
Redirected to http://www.example.com/
Completed in 8ms (DB: 3) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:44:01) [GET]
Redirected to http://www.example.com/
Completed in 4ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:51:18) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 66ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:51:18) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:51:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 126ms (View: 45, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:51:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 122ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:51:19) [GET]
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 107ms (View: 83, DB: 5) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:51:19) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 45ms (View: 27, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:51:19) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 132ms (View: 122, DB: 9) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-08 18:51:19) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 86ms (View: 75, DB: 9) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:51:19) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Update (0.0ms)[0m   [0;1mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-08 22:51:19' WHERE `id` = 1050436380[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 134ms (View: 106, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-08 18:51:19) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (0.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-08 22:51:19' WHERE `id` = 664089248[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 157ms (View: 131, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:51:19) [GET]
Redirected to http://www.example.com/
Completed in 13ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-08 18:51:19) [GET]
Redirected to http://www.example.com/
Completed in 6ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:51:51) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 77ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-08 18:51:52) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 16ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:51:52) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 108ms (View: 35, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-08 18:51:52) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (3.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 123ms (DB: 11) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-08 18:51:52) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 89ms (View: 68, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-08 18:51:52) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 45ms (View: 27, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;36;1mPlayer Load (5.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:15:19) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 86ms (DB: 132) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:15:20) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:15:20) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 154ms (View: 83, DB: 6) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:15:20) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 96ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:15:20) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 94ms (View: 76, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:15:20) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m

ActionView::TemplateError (undefined local variable or method `window' for #<ActionView::Base:0x27261218>) on line #11 of app/views/site/get_opponent.rjs:
8: unless game.opponent.nil?
9:   logger.info "redirecting to play"
10:   #page.redirect_to :action => "play"
11:   window.location = url_for(:action => 'play')
12:   #page.redirect_to url_for(:action => 'play')
13: end
14: 

    app/views/site/get_opponent.rjs:11:in `_run_rjs_app47views47site47get_opponent46rjs'
    app/views/site/get_opponent.rjs:1:in `_run_rjs_app47views47site47get_opponent46rjs'
    test/integration/playing_game_test.rb:34:in `test_simple_game'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendered rescues/_trace (272.0ms)
Rendered rescues/_request_and_response (13.0ms)
Rendering rescues/layout (internal_server_error)
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:19:05) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 399ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:19:06) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:19:06) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 95ms (View: 26, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:19:06) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 81ms (DB: 5) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:19:06) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 72ms (View: 55, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:19:07) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 36ms (View: 3, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:19:56) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 373ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:19:57) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:19:57) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 96ms (View: 28, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:19:57) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (3.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 102ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:19:57) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 75ms (View: 58, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:19:57) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 43ms (View: 4, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:22:35) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 54ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:22:36) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:22:36) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 111ms (View: 38, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:22:36) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 94ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:22:36) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 76ms (View: 57, DB: 2) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:22:36) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 45ms (View: 6, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:26:31) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 59ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:26:31) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:26:32) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 100ms (View: 30, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:26:32) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 101ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:26:32) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 77ms (View: 60, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:26:32) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 34ms (View: 3, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:42:23) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 379ms (DB: 28) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:42:24) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:42:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 170ms (View: 108, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:42:24) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 86ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:42:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 84ms (View: 66, DB: 2) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:42:24) [POST]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m

NoMethodError (undefined method `javascript_tag' for #<SiteController:0x73d742a1>):
  app/controllers/site_controller.rb:125:in `get_opponent'
  test/integration/playing_game_test.rb:34:in `test_simple_game'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
  C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
  C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendered rescues/_trace (216.0ms)
Rendered rescues/_request_and_response (20.0ms)
Rendering rescues/layout (internal_server_error)
  [4;36;1mSQL (3.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:49:23) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (12.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 97ms (DB: 37) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:49:23) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:49:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 101ms (View: 31, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:49:23) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 110ms (DB: 12) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:49:24) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 73ms (View: 56, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:49:24) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 37ms (View: 4, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:54:47) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 69ms (DB: 22) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:54:47) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:54:47) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 100ms (View: 29, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:54:48) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 82ms (DB: 5) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:54:48) [GET]
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 93ms (View: 66, DB: 5) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:54:48) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 38ms (View: 21, DB: 2) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:56:50) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 55ms (DB: 20) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:56:50) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:56:50) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 105ms (View: 35, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:56:51) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 106ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:56:51) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 87ms (View: 68, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:56:51) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 49ms (View: 24, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:58:18) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 75ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 17:58:18) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:58:18) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 98ms (View: 35, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 17:58:18) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (3.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 107ms (DB: 10) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 17:58:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 91ms (View: 70, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 17:58:19) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 45ms (View: 24, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:08:09) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 70ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:08:10) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 16ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:08:10) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 124ms (View: 48, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:08:10) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 106ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 18:08:10) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 83ms (View: 62, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 18:08:10) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 43ms (View: 25, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (7.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:38:05) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (14.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 380ms (DB: 38) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:38:06) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:38:06) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 97ms (View: 34, DB: 6) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:38:06) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 104ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 18:38:06) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 84ms (View: 63, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 18:38:06) [POST]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Redirected to http://www.example.com/site/play
Completed in 44ms (DB: 4) | 302 Found [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 18:38:06) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 123ms (View: 45, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 18:38:07) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 160ms (View: 147, DB: 10) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 18:38:07) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 72ms (View: 64, DB: 7) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 18:38:07) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (0.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 22:38:07' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 116ms (View: 90, DB: 9) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 18:38:07) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 22:38:07' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 206ms (View: 162, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 18:38:07) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 18:38:07) [GET]
Redirected to http://www.example.com/
Completed in 4ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:41:46) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 57ms (DB: 26) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 18:41:47) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:41:47) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 89ms (View: 32, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 18:41:47) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 103ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 18:41:47) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 84ms (View: 67, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 18:41:47) [POST]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Redirected to http://www.example.com/site/play
Completed in 47ms (DB: 4) | 302 Found [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 18:41:47) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 73ms (View: 41, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 18:41:47) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (8.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (3.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 127ms (View: 107, DB: 19) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 18:41:47) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 75ms (View: 65, DB: 6) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 18:41:47) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (0.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 22:41:48' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 111ms (View: 85, DB: 10) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 18:41:48) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 22:41:48' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 204ms (View: 173, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 18:41:48) [GET]
Redirected to http://www.example.com/
Completed in 4ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 18:41:48) [GET]
Redirected to http://www.example.com/
Completed in 6ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:35:54) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 102ms (DB: 41) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:35:55) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:35:55) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 128ms (View: 41, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:35:55) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 110ms (DB: 11) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:35:55) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 117ms (View: 96, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:35:55) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 56ms (View: 8, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:36:54) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 76ms (DB: 22) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:36:54) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:36:54) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 106ms (View: 35, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:36:55) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 99ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:36:55) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 103ms (View: 82, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:36:55) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 56ms (View: 13, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:36:55) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 131ms (View: 122, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:36:55) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 84ms (View: 76, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:36:55) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 23:36:55' WHERE `id` = 1050436380[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 138ms (View: 111, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:36:55) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 23:36:55' WHERE `id` = 664089248[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 167ms (View: 137, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:36:55) [GET]
Redirected to http://www.example.com/
Completed in 12ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:36:56) [GET]
Redirected to http://www.example.com/
Completed in 6ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (3.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:46:40) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 69ms (DB: 25) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:46:41) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:46:41) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 100ms (View: 34, DB: 6) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:46:41) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (2.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 117ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:46:41) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 89ms (View: 67, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:46:41) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 43ms (View: 7, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (7.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:50:49) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 377ms (DB: 32) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:50:50) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:50:50) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 133ms (View: 52, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:50:50) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 100ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:50:50) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 92ms (View: 72, DB: 5) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:50:50) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Redirected to http://www.example.com/site/play
Completed in 40ms (DB: 3) | 302 Found [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:50:50) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 80ms (View: 47, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:50:51) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (2.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 104ms (View: 91, DB: 11) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:50:51) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 79ms (View: 70, DB: 9) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:50:51) [POST]
  [4;36;1mPlayer Load (5.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (0.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 23:50:51' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (3.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 130ms (View: 94, DB: 17) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:50:51) [POST]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 23:50:51' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 218ms (View: 166, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:50:51) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:50:51) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (7.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:51:25) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 87ms (DB: 29) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:51:26) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:51:26) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 111ms (View: 41, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:51:26) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (9.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 130ms (DB: 16) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:51:26) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 100ms (View: 82, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:51:26) [POST]
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Redirected to http://www.example.com/site/play
Completed in 40ms (DB: 6) | 302 Found [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:51:26) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 88ms (View: 46, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:51:27) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 113ms (View: 104, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:51:27) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 96ms (View: 84, DB: 9) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:51:27) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 23:51:27' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 150ms (View: 113, DB: 16) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:51:27) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (0.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (0.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 23:51:27' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 201ms (View: 163, DB: 13) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:51:27) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:51:27) [GET]
Redirected to http://www.example.com/
Completed in 6ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:56:23) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 382ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:56:24) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 16ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:56:24) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 134ms (View: 45, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:56:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 118ms (DB: 10) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:56:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 101ms (View: 78, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:56:24) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 54ms (View: 7, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:56:24) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 142ms (View: 131, DB: 9) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:56:25) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 82ms (View: 74, DB: 7) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:56:25) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (6.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 23:56:25' WHERE `id` = 1050436380[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 124ms (View: 88, DB: 18) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:56:25) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;35;1mPlayer Update (2.0ms)[0m   [0mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 23:56:25' WHERE `id` = 664089248[0m
  [4;36;1mGame Update with optimistic locking (2.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 203ms (View: 171, DB: 16) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:56:25) [GET]
Redirected to http://www.example.com/
Completed in 13ms (DB: 3) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:56:25) [GET]
Redirected to http://www.example.com/
Completed in 6ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:58:22) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (8.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 83ms (DB: 37) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:58:22) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (8.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 21ms (DB: 8) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:58:23) [GET]
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 128ms (View: 39, DB: 6) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:58:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (2.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 102ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:58:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 74ms (View: 55, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:58:23) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m

ActionView::TemplateError (undefined method `redirect_to' for #<ActionView::Base:0x1e893918>) on line #11 of app/views/site/get_opponent.rjs:
8: unless game.opponent.nil?
9:   logger.info "redirecting to play"
10:   #page.redirect_to :action => "play"
11:   redirect_to :action => "play"
12:   #page.redirect_to url_for(:action => 'play')
13: end
14: 

    app/views/site/get_opponent.rjs:11:in `_run_rjs_app47views47site47get_opponent46rjs'
    app/views/site/get_opponent.rjs:1:in `_run_rjs_app47views47site47get_opponent46rjs'
    test/integration/playing_game_test.rb:34:in `test_simple_game'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendered rescues/_trace (330.0ms)
Rendered rescues/_request_and_response (14.0ms)
Rendering rescues/layout (internal_server_error)


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:58:23) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 136ms (View: 127, DB: 13) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-09 19:58:24) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (2.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 110ms (View: 93, DB: 15) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:58:24) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (2.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Update (0.0ms)[0m   [0;1mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-09 23:58:24' WHERE `id` = 1050436380[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 112ms (View: 90, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-09 19:58:24) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;35;1mWeapon Load (2.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;35;1mPlayer Update (2.0ms)[0m   [0mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-09 23:58:24' WHERE `id` = 664089248[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 190ms (View: 159, DB: 15) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:58:24) [GET]
Redirected to http://www.example.com/
Completed in 9ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-09 19:58:24) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (8.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:59:00) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 435ms (DB: 28) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 19:59:01) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 18ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:59:01) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 111ms (View: 37, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 19:59:01) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (3.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 151ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 19:59:01) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 109ms (View: 85, DB: 6) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 19:59:01) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m

ActionView::TemplateError (undefined method `redirect_to' for #<ActionView::Base:0x27341e11>) on line #11 of app/views/site/get_opponent.rjs:
8: unless game.opponent.nil?
9:   logger.info "redirecting to play"
10:   #page.redirect_to :action => "play"
11:   redirect_to :action => "play"
12:   #page.redirect_to url_for(:action => 'play')
13: end
14: 

    app/views/site/get_opponent.rjs:11:in `_run_rjs_app47views47site47get_opponent46rjs'
    app/views/site/get_opponent.rjs:1:in `_run_rjs_app47views47site47get_opponent46rjs'
    test/integration/playing_game_test.rb:34:in `test_simple_game'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendered rescues/_trace (354.0ms)
Rendered rescues/_request_and_response (19.0ms)
Rendering rescues/layout (internal_server_error)
  [4;36;1mSQL (316.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 20:02:19) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 62ms (DB: 338) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 20:02:19) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (4.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 18ms (DB: 4) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 20:02:19) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 114ms (View: 37, DB: 7) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 20:02:19) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (7.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 121ms (DB: 13) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 20:02:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 98ms (View: 77, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 20:02:20) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 52ms (View: 31, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 20:12:22) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 385ms (DB: 28) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 20:12:23) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 17ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 20:12:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 108ms (View: 36, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 20:12:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 127ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 20:12:23) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 110ms (View: 85, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 20:12:23) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 51ms (View: 28, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:50:42) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 69ms (DB: 45) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:50:43) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:50:43) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 124ms (View: 42, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:50:43) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 113ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 23:50:43) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 107ms (View: 85, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 23:50:43) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 65ms (View: 30, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:51:44) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 361ms (DB: 26) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:51:45) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:51:45) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 114ms (View: 35, DB: 3) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:51:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 97ms (DB: 5) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 23:51:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 98ms (View: 76, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 23:51:46) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m

ActionView::TemplateError (undefined method `redirect_to' for #<ActionView::Base:0x775be8d3>) on line #11 of app/views/site/get_opponent.rjs:
8: unless game.opponent.nil?
9:   logger.info "redirecting to play"
10:   #page.redirect_to :action => "play" # <- works in browser
11:   redirect_to :action => "play"
12:   #page.redirect_to url_for(:action => 'play')
13: end
14: 

    app/views/site/get_opponent.rjs:11:in `_run_rjs_app47views47site47get_opponent46rjs'
    app/views/site/get_opponent.rjs:1:in `_run_rjs_app47views47site47get_opponent46rjs'
    test/integration/playing_game_test.rb:34:in `test_simple_game'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:34:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/testsuite.rb:33:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/jruby-1.5.1/lib/ruby/1.8/test/unit/ui/testrunnermediator.rb:46:in `run_suite'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:51:in `run'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `each'
    C:/Program Files/NetBeans 6.9.1/ruby/nb_suite_runner.rb:45:in `run'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:168:in `run_mediator'
    C:\Program Files\NetBeans 6.9.1\ruby\nb_test_mediator.rb:209

Rendered rescues/_trace (315.0ms)
Rendered rescues/_request_and_response (16.0ms)
Rendering rescues/layout (internal_server_error)
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:55:42) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 364ms (DB: 28) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-09 23:55:43) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:55:43) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 95ms (View: 31, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-09 23:55:43) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 113ms (DB: 8) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-09 23:55:43) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 88ms (View: 68, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-09 23:55:43) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 45ms (View: 25, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:12:18) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 68ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:12:19) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 13ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:12:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 104ms (View: 32, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:12:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (3.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (2.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 115ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 00:12:19) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 78ms (View: 58, DB: 2) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 00:12:19) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 42ms (View: 25, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:38:49) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 380ms (DB: 24) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:38:50) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 15ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:38:50) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 106ms (View: 36, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:38:50) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 109ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 00:38:50) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 90ms (View: 67, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 00:38:50) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 46ms (View: 26, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:39:45) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 67ms (DB: 22) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:39:46) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:39:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 98ms (View: 31, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:39:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 86ms (DB: 5) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 00:39:46) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 84ms (View: 66, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 00:39:46) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 47ms (View: 23, DB: 5) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:53:07) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 359ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 00:53:08) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 12ms (DB: 1) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:53:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 93ms (View: 32, DB: 2) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 00:53:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 104ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 00:53:08) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 79ms (View: 60, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 00:53:08) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 44ms (View: 23, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:14:29) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 60ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:14:29) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 11ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:14:29) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 108ms (View: 37, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:14:29) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 103ms (DB: 6) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 01:14:29) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 73ms (View: 54, DB: 4) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 01:14:30) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 39ms (View: 25, DB: 2) | 200 OK [http://www.example.com/site/get_opponent]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:15:24) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 59ms (DB: 23) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:15:24) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:15:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 88ms (View: 28, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:15:24) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 100ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 01:15:25) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 80ms (View: 62, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 01:15:25) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 47ms (View: 25, DB: 4) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 01:15:25) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 81ms (View: 43, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-10 01:15:25) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 89ms (View: 82, DB: 7) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-10 01:15:25) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 68ms (View: 59, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-10 01:15:25) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (0.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-10 05:15:25' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 107ms (View: 74, DB: 9) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-10 01:15:25) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (0.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-10 05:15:25' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 155ms (View: 127, DB: 10) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-10 01:15:25) [GET]
Redirected to http://www.example.com/
Completed in 4ms (DB: 3) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-10 01:15:25) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:16:45) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 67ms (DB: 21) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-10 01:16:46) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:16:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `is_waiting` = 1, `opponent_id` = NULL, `lock_version` = 1
 WHERE id = 670108558
 AND `lock_version` = 0
[0m
Rendering site/waiting
Completed in 89ms (View: 28, DB: 4) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-10 01:16:46) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = 1050436380, `lock_version` = 1
 WHERE id = 1056463418
 AND `lock_version` = 0
[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = 664089248, `is_waiting` = 0, `lock_version` = 2
 WHERE id = 670108558
 AND `lock_version` = 1
[0m
Redirected to http://www.example.com/site/play
Completed in 101ms (DB: 7) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 01:16:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 87ms (View: 70, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-10 01:16:46) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 38ms (View: 22, DB: 3) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-10 01:16:46) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 71ms (View: 39, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-10 01:16:46) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 927579042, `lock_version` = 2
 WHERE id = 1056463418
 AND `lock_version` = 1
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 927579042, `lock_version` = 3
 WHERE id = 670108558
 AND `lock_version` = 2
[0m
Completed in 99ms (View: 89, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-10 01:16:46) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `games`
 SET `player_weapon_id` = 236609559, `lock_version` = 4
 WHERE id = 670108558
 AND `lock_version` = 3
[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update with optimistic locking (0.0ms)[0m   [0m UPDATE `games`
 SET `opponent_weapon_id` = 236609559, `lock_version` = 3
 WHERE id = 1056463418
 AND `lock_version` = 2
[0m
Completed in 74ms (View: 67, DB: 6) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-10 01:16:46) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (0.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (0.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-10 05:16:47' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 5
 WHERE id = 670108558
 AND `lock_version` = 4
[0m
Completed in 94ms (View: 70, DB: 9) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-10 01:16:47) [POST]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (0.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (0.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (0.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-10 05:16:47' WHERE `id` = 664089248[0m
  [4;35;1mGame Update with optimistic locking (1.0ms)[0m   [0m UPDATE `games`
 SET `opponent_id` = NULL, `opponent_weapon_id` = NULL, `lock_version` = 4
 WHERE id = 1056463418
 AND `lock_version` = 3
[0m
Completed in 208ms (View: 171, DB: 9) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-10 01:16:47) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 2) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-10 01:16:47) [GET]
Redirected to http://www.example.com/
Completed in 5ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (3.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('fred', NULL, 0, '2011-10-12 01:13:49', '2011-10-12 01:13:49')[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `player_id` = 1050436381 WHERE `id` = 1056463419[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;35;1mPlayer Load (0.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('bob', NULL, 0, '2011-10-12 01:13:49', '2011-10-12 01:13:49')[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `player_id` = 1050436382 WHERE `id` = 1056463420[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `is_waiting` = 1 WHERE `id` = 1056463419[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = 1050436381 WHERE `id` = 1056463420[0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 1050436382, `is_waiting` = 0 WHERE `id` = 1056463419[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436382)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;35;1mWeapon Load (9.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'rock') LIMIT 1[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `player_weapon_id` = 927579042 WHERE `id` = 1056463420[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436381) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_weapon_id` = 927579042 WHERE `id` = 1056463419[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436382)) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = NULL WHERE `id` = 1056463419[0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = NULL WHERE `id` = 1056463420[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436381)) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;36;1mGame Update (6.0ms)[0m   [0;1mUPDATE `games` SET `opponent_weapon_id` = NULL WHERE `id` = 1056463419[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `is_waiting` = 1 WHERE `id` = 1056463419[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `player_weapon_id` = NULL WHERE `id` = 1056463420[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = 1050436381 WHERE `id` = 1056463420[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 1050436382, `is_waiting` = 0 WHERE `id` = 1056463419[0m
  [4;36;1mPlayer Load (0.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;36;1mPlayer Load (7.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (7.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (4.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (2.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `is_waiting` = 1, `opponent_id` = NULL WHERE `id` = 670108558[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 664089248, `is_waiting` = 0 WHERE `id` = 670108558[0m
  [4;36;1mSQL (2.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (6.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "Not pass1", score: 0, created_at: "2011-10-12 01:16:42", updated_at: "2011-10-12 01:16:42">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'Not pass1') LIMIT 1[0m
Rendering site/login
Completed in 74ms (View: 36, DB: 20) | 200 OK [http://test.host/?player=1050436380]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "pass1", score: 0, created_at: "2011-10-12 01:16:42", updated_at: "2011-10-12 01:16:42">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://test.host/site/home
Completed in 26ms (DB: 3) | 302 Found [http://test.host/?player=1050436380]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "pass1", score: 0, created_at: "2011-10-12 01:16:42", updated_at: "2011-10-12 01:16:42">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://test.host/site/home
Completed in 9ms (DB: 2) | 302 Found [http://test.host/?player=1050436380]


Processing SiteController#logout (for 0.0.0.0 at 2011-10-11 21:16:43) [GET]
Redirected to http://test.host/
Completed in 3ms (DB: 0) | 302 Found [http://test.host/?player=1050436380]


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>{"name"=>"Ruby", "password"=>"Rails", "password_confirmation"=>"Grails"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
Rendering site/register
Completed in 41ms (View: 27, DB: 1) | 200 OK [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Grails]
  [4;36;1mPlayer Load (44.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
Rendering site/register
Completed in 51ms (View: 29, DB: 49) | 200 OK [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Grails]


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:16:43) [POST]
  Parameters: {"player"=>{"name"=>"Ruby", "password"=>"Rails", "password_confirmation"=>"Rails"}}
  [4;36;1mPlayer Load (0.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('Ruby', 'Rails', 0, '2011-10-12 01:16:43', '2011-10-12 01:16:43')[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436383) LIMIT 1[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `player_id` = 1050436383 WHERE `id` = 1056463421[0m
  [4;35;1mPlayer Load (0.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby' AND `players`.id <> 1050436383) LIMIT 1[0m
Redirected to http://test.host/
Completed in 134ms (DB: 4) | 302 Found [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Rails]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;36;1mPlayer Load (13.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `is_waiting` = 1, `opponent_id` = NULL WHERE `id` = 670108558[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 664089248, `is_waiting` = 0 WHERE `id` = 670108558[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`id` = 670108558) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('fred', NULL, 0, '2011-10-12 01:18:15', '2011-10-12 01:18:15')[0m
  [4;36;1mGame Update (2.0ms)[0m   [0;1mUPDATE `games` SET `player_id` = 1050436381 WHERE `id` = 1056463419[0m
  [4;35;1mSQL (1.0ms)[0m   [0mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mSQL (4.0ms)[0m   [0mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('bob', NULL, 0, '2011-10-12 01:18:15', '2011-10-12 01:18:15')[0m
  [4;36;1mGame Update (2.0ms)[0m   [0;1mUPDATE `games` SET `player_id` = 1050436382 WHERE `id` = 1056463420[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mPlayer Load (3.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `is_waiting` = 1 WHERE `id` = 1056463419[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 1050436381 WHERE `id` = 1056463420[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = 1050436382, `is_waiting` = 0 WHERE `id` = 1056463419[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436382)) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'rock') LIMIT 1[0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `player_weapon_id` = 927579042 WHERE `id` = 1056463420[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436381) LIMIT 1[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `opponent_weapon_id` = 927579042 WHERE `id` = 1056463419[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436382)) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = NULL WHERE `id` = 1056463419[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = NULL WHERE `id` = 1056463420[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436381)) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'fred') LIMIT 1[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436381) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_weapon_id` = NULL WHERE `id` = 1056463419[0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `is_waiting` = 1 WHERE `id` = 1056463419[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'bob') LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436382) LIMIT 1[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `player_weapon_id` = NULL WHERE `id` = 1056463420[0m
  [4;35;1mGame Load (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436381) [0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 1050436381 WHERE `id` = 1056463420[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = 1050436382, `is_waiting` = 0 WHERE `id` = 1056463419[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (10.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:18:34) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "Not pass1", score: 0, created_at: "2011-10-12 01:18:34", updated_at: "2011-10-12 01:18:34">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'Not pass1') LIMIT 1[0m
Rendering site/login
Completed in 58ms (View: 33, DB: 30) | 200 OK [http://test.host/?player=1050436380]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:18:34) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "pass1", score: 0, created_at: "2011-10-12 01:18:34", updated_at: "2011-10-12 01:18:34">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://test.host/site/home
Completed in 30ms (DB: 3) | 302 Found [http://test.host/?player=1050436380]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#login (for 0.0.0.0 at 2011-10-11 21:18:34) [POST]
  Parameters: {"player"=>#<Player id: 1050436380, name: "player1", password: "pass1", score: 0, created_at: "2011-10-12 01:18:34", updated_at: "2011-10-12 01:18:34">}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://test.host/site/home
Completed in 9ms (DB: 3) | 302 Found [http://test.host/?player=1050436380]


Processing SiteController#logout (for 0.0.0.0 at 2011-10-11 21:18:34) [GET]
Redirected to http://test.host/
Completed in 2ms (DB: 0) | 302 Found [http://test.host/?player=1050436380]


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:18:34) [POST]
  Parameters: {"player"=>{"name"=>"Ruby", "password"=>"Rails", "password_confirmation"=>"Grails"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
Rendering site/register
Completed in 45ms (View: 27, DB: 2) | 200 OK [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Grails]
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:18:34) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
Rendering site/register
Completed in 54ms (View: 39, DB: 4) | 200 OK [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Grails]


Processing SiteController#register (for 0.0.0.0 at 2011-10-11 21:18:35) [POST]
  Parameters: {"player"=>{"name"=>"Ruby", "password"=>"Rails", "password_confirmation"=>"Rails"}}
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby') LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mINSERT INTO `players` (`name`, `password`, `score`, `created_at`, `updated_at`) VALUES('Ruby', 'Rails', 0, '2011-10-12 01:18:35', '2011-10-12 01:18:35')[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mINSERT INTO `games` (`player_id`, `opponent_id`, `player_weapon_id`, `opponent_weapon_id`, `is_waiting`) VALUES(NULL, NULL, NULL, NULL, 0)[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436383) LIMIT 1[0m
  [4;36;1mGame Update (3.0ms)[0m   [0;1mUPDATE `games` SET `player_id` = 1050436383 WHERE `id` = 1056463421[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'Ruby' AND `players`.id <> 1050436383) LIMIT 1[0m
Redirected to http://test.host/
Completed in 171ms (DB: 8) | 302 Found [http://test.host/site/register?player%5Bname%5D=Ruby&player%5Bpassword%5D=Rails&player%5Bpassword_confirmation%5D=Rails]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m
  [4;35;1mPlayer Load (12.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#login (for 127.0.0.1 at 2011-10-11 21:18:54) [POST]
  Parameters: {"player"=>{"name"=>"player1", "password"=>"pass1"}}
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.`password` = 'pass1') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 234ms (DB: 31) | 302 Found [http://www.example.com/site/login]


Processing SiteController#login (for 127.0.0.1 at 2011-10-11 21:18:56) [POST]
  Parameters: {"player"=>{"name"=>"player2", "password"=>"pass2"}}
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.`password` = 'pass2') LIMIT 1[0m
Redirected to http://www.example.com/site/home
Completed in 14ms (DB: 2) | 302 Found [http://www.example.com/site/login]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-11 21:18:56) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (2.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mGame Update (1.0ms)[0m   [0;1mUPDATE `games` SET `is_waiting` = 1, `opponent_id` = NULL WHERE `id` = 670108558[0m
Rendering site/waiting
Completed in 106ms (View: 39, DB: 5) | 200 OK [http://www.example.com/site/waiting]


Processing SiteController#waiting (for 127.0.0.1 at 2011-10-11 21:18:56) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.`is_waiting` = 1) LIMIT 1[0m
  [4;36;1mPlayer Load (4.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = 1050436380 WHERE `id` = 1056463418[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = 664089248, `is_waiting` = 0 WHERE `id` = 670108558[0m
Redirected to http://www.example.com/site/play
Completed in 109ms (DB: 9) | 302 Found [http://www.example.com/site/waiting]


Processing SiteController#play (for 127.0.0.1 at 2011-10-11 21:18:57) [GET]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/play
Completed in 113ms (View: 92, DB: 3) | 200 OK [http://www.example.com/site/play]


Processing SiteController#get_opponent (for 127.0.0.1 at 2011-10-11 21:18:57) [POST]
Rendering site/get_opponent
  [4;36;1mPlayer Load (15.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (11.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Completed in 95ms (View: 38, DB: 29) | 200 OK [http://www.example.com/site/get_opponent]


Processing SiteController#play (for 127.0.0.1 at 2011-10-11 21:18:57) [GET]
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Load (5.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/play
Completed in 110ms (View: 60, DB: 8) | 200 OK [http://www.example.com/site/play]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-11 21:18:57) [POST]
  Parameters: {"choice"=>"Rock"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;35;1mPlayer Load (2.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 664089248)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `player_weapon_id` = 927579042 WHERE `id` = 1056463418[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 1050436380) LIMIT 1[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_weapon_id` = 927579042 WHERE `id` = 670108558[0m
Completed in 107ms (View: 98, DB: 8) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#set_my_choice (for 127.0.0.1 at 2011-10-11 21:18:57) [POST]
  Parameters: {"choice"=>"Paper"}
Rendering site/set_my_choice
  [4;36;1mPlayer Load (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.* FROM `players` INNER JOIN `games` ON `players`.id = `games`.opponent_id WHERE ((`games`.player_id = 1050436380)) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `player_weapon_id` = 236609559 WHERE `id` = 670108558[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.`player_id` = 664089248) LIMIT 1[0m
  [4;35;1mGame Update (0.0ms)[0m   [0mUPDATE `games` SET `opponent_weapon_id` = 236609559 WHERE `id` = 1056463418[0m
Completed in 96ms (View: 89, DB: 5) | 200 OK [http://www.example.com/site/set_my_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-11 21:18:57) [POST]
  [4;36;1mPlayer Load (1.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mGame Load (1.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
Rendering site/get_their_choice
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `games` WHERE (`games`.player_id = 1050436380) LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mPlayer Load (2.0ms)[0m   [0;1mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player1' AND `players`.id <> 1050436380) LIMIT 1[0m
  [4;35;1mPlayer Update (1.0ms)[0m   [0mUPDATE `players` SET `score` = 1, `updated_at` = '2011-10-12 01:18:57' WHERE `id` = 1050436380[0m
  [4;36;1mGame Update (0.0ms)[0m   [0;1mUPDATE `games` SET `opponent_id` = NULL, `opponent_weapon_id` = NULL WHERE `id` = 670108558[0m
Completed in 138ms (View: 97, DB: 12) | 200 OK [http://www.example.com/site/get_their_choice]


Processing SiteController#get_their_choice (for 127.0.0.1 at 2011-10-11 21:18:57) [POST]
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mGame Load (1.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 1050436380) [0m
Rendering site/get_their_choice
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Rock') LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Paper') LIMIT 1[0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`name` = 'Scissors') LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `games` WHERE (`games`.player_id = 664089248) LIMIT 1[0m
  [4;35;1mWeapon Load (1.0ms)[0m   [0mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 236609559) [0m
  [4;36;1mWeapon Load (1.0ms)[0m   [0;1mSELECT * FROM `weapons` WHERE (`weapons`.`id` = 927579042) [0m
  [4;35;1mPlayer Load (1.0ms)[0m   [0mSELECT `players`.id FROM `players` WHERE (`players`.`name` = 'player2' AND `players`.id <> 664089248) LIMIT 1[0m
  [4;36;1mPlayer Update (1.0ms)[0m   [0;1mUPDATE `players` SET `score` = -1, `updated_at` = '2011-10-12 01:18:58' WHERE `id` = 664089248[0m
  [4;35;1mGame Update (1.0ms)[0m   [0mUPDATE `games` SET `opponent_id` = NULL, `opponent_weapon_id` = NULL WHERE `id` = 1056463418[0m
Completed in 203ms (View: 160, DB: 11) | 200 OK [http://www.example.com/site/get_their_choice]
  [4;36;1mPlayer Load (3.0ms)[0m   [0;1mSELECT * FROM `players` WHERE (`players`.`name` = 'player1') LIMIT 1[0m
  [4;35;1mPlayer Load (9.0ms)[0m   [0mSELECT * FROM `players` WHERE (`players`.`id` = 664089248) [0m


Processing SiteController#logout (for 127.0.0.1 at 2011-10-11 21:18:58) [GET]
Redirected to http://www.example.com/
Completed in 7ms (DB: 12) | 302 Found [http://www.example.com/site/logout]


Processing SiteController#logout (for 127.0.0.1 at 2011-10-11 21:18:58) [GET]
Redirected to http://www.example.com/
Completed in 7ms (DB: 0) | 302 Found [http://www.example.com/site/logout]
